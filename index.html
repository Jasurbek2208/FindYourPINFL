<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Special Passport PINFL</title>
</head>
<body>
    <h1>Generate Special Passport PINFL</h1>
    <form id="generatePassportForm">
        <label for="series">Passport Series:</label>
        <input type="text" id="series" name="series" required><br><br>
        <label for="number">Passport Number:</label>
        <input type="text" id="number" name="number" required><br><br>
        <label for="dob">Date of Birth:</label>
        <input type="date" id="dob" name="dob" required><br><br>
        <label for="captchaImg">Captcha Image (Dec nums):</label><br>
        <img src="" id="captchaImg" alt="Captcha Image"><br><br>
        <label for="captchaResult">Captcha Image Result Number:</label>
        <input type="number" id="captchaResult" name="captchaResult" required><br><br>
        <button type="button" id="getCaptchaBtn">Get Captcha</button><br><br>
        <button type="submit">Generate Special PINFL</button>
    </form>
    <div id="specialPinResult"></div>

    <script>
        let captchaId

        async function getCaptcha() {
            try {
                const res = await fetch("https://clients.ahost.uz/index.php?m=authorization&action=main/captcha", {
                    method: "GET"
                })
                const data = await res.json();
                captchaId = data.captchaId;
                const captchaImageBase64 = data.captchaImageBase64;
                document.getElementById("captchaImg").src = captchaImageBase64;
            } catch(err) {
                console.log(err);
            }
        }

        async function getUserPINFL(series, number, dob, captchaResult) {
            try {
                const formData = new FormData()
                formData.append('passnumber', series + number);
        formData.append('datebirth', dob);
        formData.append('captcha_id', captchaId);
        formData.append('captcha', captchaResult);
                const res = await fetch(`https://corsproxy.io/?${encodeURIComponent("https://clients.ahost.uz/index.php?m=authorization&action=main/getPinfl")}`, {
                    method: "POST",
                  //  headers: {
                      //  "Content-Type": "application/json",
                      //  "Cookie": "allureNavCollapse=active; WHMCSsqtl4hicSxva=lfa47c54ifhh7f4gkcjfdlfbjq",
            //    "Referer": "https://clients.ahost.uz/register.php"
               //     },
                    body: formData
                });
                const data = await res.json();
                console.log(data)
                return data.data.personalNum;
            } catch(err) {
                console.log(err);
            }
        }

        document.getElementById("getCaptchaBtn").addEventListener("click", async function() {
            await getCaptcha();
        });

        document.getElementById("generatePassportForm").addEventListener("submit", async function(event) {
            event.preventDefault(); // Prevent form submission
            let series = document.getElementById("series").value;
            let number = document.getElementById("number").value;
            let dob = document.getElementById("dob").value;
            let captchaResult = document.getElementById("captchaResult").value; 
            let specialPinFL = await getUserPINFL(series, number, dob, captchaResult);
            document.getElementById("specialPinResult").innerText = "Generated Special Passport PINFL: " + specialPinFL;
        });
    </script>
</body>
</html>